<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">Creating a COVID-19 info chatbot with Facebook app and Wit.ai | Chatbot for Class</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Creating a COVID-19 info chatbot with Facebook app and Wit.ai | Chatbot for Class"><meta data-react-helmet="true" name="description" content="You are going to create a Facebook Messenger Chatbot in this tutorial, which will inform users whether it&#x27;s safe to perform a certain activity or not. It will also provide a handy advice on how to stay safe during COVID-19 pandemic."><meta data-react-helmet="true" property="og:description" content="You are going to create a Facebook Messenger Chatbot in this tutorial, which will inform users whether it&#x27;s safe to perform a certain activity or not. It will also provide a handy advice on how to stay safe during COVID-19 pandemic."><meta data-react-helmet="true" property="og:url" content="https://romanenko.github.com/covid19-safety-information/covid19-safety-information/docs/tutorial"><link data-react-helmet="true" rel="shortcut icon" href="/covid19-safety-information/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://romanenko.github.com/covid19-safety-information/covid19-safety-information/docs/tutorial"><link rel="stylesheet" href="/covid19-safety-information/styles.124d905b.css">
<link rel="preload" href="/covid19-safety-information/styles.a26654e4.js" as="script">
<link rel="preload" href="/covid19-safety-information/runtime~main.0f70fe0a.js" as="script">
<link rel="preload" href="/covid19-safety-information/main.8d183635.js" as="script">
<link rel="preload" href="/covid19-safety-information/1.8fe4b8f7.js" as="script">
<link rel="preload" href="/covid19-safety-information/14.a472f813.js" as="script">
<link rel="preload" href="/covid19-safety-information/15.9249cfa6.js" as="script">
<link rel="preload" href="/covid19-safety-information/935f2afb.c60e4987.js" as="script">
<link rel="preload" href="/covid19-safety-information/13.2fafe2e3.js" as="script">
<link rel="preload" href="/covid19-safety-information/60875e34.75ca0863.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/covid19-safety-information/"><img src="/covid19-safety-information/img/logo.svg" alt="Chatbot for Class" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/covid19-safety-information/img/logo.svg" alt="Chatbot for Class" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Chatbot for Class</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/covid19-safety-information/docs/">Get Started</a><a href="http://m.me/111708907337870" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Try it out</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/romanenko/covid19-safety-information" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/covid19-safety-information/"><img src="/covid19-safety-information/img/logo.svg" alt="Chatbot for Class" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/covid19-safety-information/img/logo.svg" alt="Chatbot for Class" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Chatbot for Class</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/covid19-safety-information/docs/">Get Started</a></li><li class="menu__list-item"><a href="http://m.me/111708907337870" target="_blank" rel="noopener noreferrer" class="menu__link">Try it out</a></li><li class="menu__list-item"><a href="https://github.com/romanenko/covid19-safety-information" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Docusaurus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/covid19-safety-information/docs/">Style Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/covid19-safety-information/docs/doc2">Document Number 2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/covid19-safety-information/docs/doc3">This is Document Number 3</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/covid19-safety-information/docs/mdx">Powered by MDX</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/covid19-safety-information/docs/tutorial">Creating a COVID-19 info chatbot with Facebook app and Wit.ai</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Creating a COVID-19 info chatbot with Facebook app and Wit.ai</h1></header><div class="markdown"><p>You are going to create a Facebook Messenger Chatbot in this tutorial, which will inform users whether it&#x27;s safe to perform a certain activity or not. It will also provide a handy advice on how to stay safe during COVID-19 pandemic. </p><p><a href="https://www.youtube.com/watch?v=FrucqUNOy9A" target="_blank" rel="noopener noreferrer">Watch the short video about it</a></p><p>After this tutorial, you and your students will know</p><ul><li>How to create a Facebook App</li><li>How to create a <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a> App</li><li>Basic knowledge of training AI models</li><li>Fun of making chatbots!</li></ul><p>Let&#x27;s explore about:  </p><p><a href="#skills-and-conversation-scenarios">Skills and Conversation Scenarios</a><br>
<a href="#dialog-example">Dialog Example</a><br>
<a href="#training-Wit.AI">Training Wit.ai</a><br>
<a href="#facebook-page">Facebook Page</a><br>
<a href="#facebook-app">Facebook App</a><br>
<a href="#glitch-app">Glitch App</a><br>
<a href="#environment-variables">Environment Variables</a><br>
<a href="#airtable">Airtable</a><br>
<a href="#testing-your-chatbot">Testing your Chatbot</a>  </p><p>Main source for health information is CDC official <a href="https://www.cdc.gov/coronavirus/2019-ncov/daily-life-coping/going-out.html" target="_blank" rel="noopener noreferrer">&quot;Daily Activities and Going Out&quot; safety guide</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="skills-and-conversation-scenarios"></a>Skills and Conversation Scenarios<a class="hash-link" href="#skills-and-conversation-scenarios" title="Direct link to heading">#</a></h2><p>Users will discover your bot via link, or by visiting a Facebook page and start chatting. It can also be embedded to any webpage <a href="https://developers.facebook.com/docs/messenger-platform/discovery/facebook-chat-plugin/" target="_blank" rel="noopener noreferrer">via Facebook Chat Plugin</a>. </p><p>Once the conversation started — bot should <strong>greet the user</strong> with introductory message, describing its purpose and giving a hint of how to start interaction — by <strong>asking what activity user is scheming to do</strong>. After that, bot will <strong>ask three questions</strong> to learn more about the environment and social distancing factors, <strong>evaluate the risk</strong> and <strong>end the conversation</strong> with a relevant link to read more about the activity on CDC website.</p><p>This brings you and your students to the three skills, you need your bot to have:</p><ol><li>Greet the user and provide instructions</li><li>Perform a simple quiz</li><li>Handle gibberish (random input) and politely bring user back to known scenarios</li></ol><p>You will use Facebook and its <a href="https://developers.facebook.com/docs/messenger-platform/" target="_blank" rel="noopener noreferrer">Messenger Platform</a> to provide conversational interface to the user, Wit.ai to make it understand input in natural language and <a href="https://airtable.com" target="_blank" rel="noopener noreferrer">Airtable</a> to store health information about the activities and to keep the progress of the Quiz.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dialog-example"></a>Dialog Example<a class="hash-link" href="#dialog-example" title="Direct link to heading">#</a></h2><p>Example of conversation the user might have with your bot:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">🤖: Hey! Nice to meet you! You can ask me for advice whether it is safe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        to perform an activity in COVID-19 pandemic times. For example: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Is is safe to go to a restaurant?&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">👩‍🦰: Is visiting a hair salon safe?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">🤖: How possible you and people around you will wear a mask?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   [ 😷  |  🤷‍♀️  | 🙂  ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">👩‍🦰: 😷 </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">🤖: How crowded the place will be? </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [🧍‍♀️ | 👫  | 👨‍👩‍👦‍👦  ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">👩‍🦰: 🧍‍♀️</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">🤖: How enclosed the space will be around you?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [ 🤸‍♀️  |  🤷‍♀️  | 🏡  ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">👩‍🦰: 🤸‍♀️</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">🤖: Ok! Seems like visiting a hair salon is a safe thing to do! </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Learn more about CDC guidelines in: https://www.cdc.gov/coronavirus/2019-ncov/daily-life-coping/personal-social-activities.html#nails</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">🤖: Try asking me about another activity. Like: &quot;Is it safe to go to the gym?&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// And so on...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="training-witai"></a>Training Wit.ai<a class="hash-link" href="#training-witai" title="Direct link to heading">#</a></h2><p><a href="http://wit.ai/" target="_blank" rel="noopener noreferrer">Wit.ai</a> is a tool to build an open source chatbot with advanced natural language(speech or messages) processing, or NLP.</p><p>Let&#x27;s start by signing up for <a href="http://wit.AI" target="_blank" rel="noopener noreferrer">Wit.ai</a> account and creating the App. After you signed up, you will see <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a> main page. Click &quot;New App&quot; to create an app.</p><p><img alt="../static/img/article/Screen_Shot_2020-10-25_at_2.56.48_PM.png" src="/covid19-safety-information/assets/images/Screen_Shot_2020-10-25_at_2.56.48_PM-d30cf425982df654d050fe887f689439.png"></p><p><img alt="../static/img/article/Screen_Shot_2020-10-25_at_3.02.07_PM.png" src="/covid19-safety-information/assets/images/Screen_Shot_2020-10-25_at_3.02.07_PM-f4105b6c575943906d1f60657068c01c.png"></p><p>In order to use Wit.ai, you need to <strong>train</strong> the model inside of it.</p><p>The goal of training is to create an accurate model that answers our questions correctly most of the time.</p><p>To train your Wit.ai app, you need to give <strong>utterances</strong> (questions that users might ask), such as:</p><p>  Is going to the gym safe?</p><p>  Is it safe to use outdoor dining?</p><p>You don’t need to describe every way of the questions. Wit will infer this from the few examples you gave. These examples are the training set of your Wit. So, the more examples you give, the better your app will understand what your users are saying.</p><p>You also want to teach Wit that you have some <strong>intent</strong> for these utterances, like getting the safety information. To do so, in the <strong>Choose or add an Intent</strong> dropdown, enter the name of your new intent and click <strong>Create Intent</strong>. </p><p><img alt="../static/img/article/Screen_Shot_2020-10-25_at_3.14.40_PM.png" src="/covid19-safety-information/assets/images/Screen_Shot_2020-10-25_at_3.14.40_PM-985da022ce2bb13cb3203b3d98588fd4.png"></p><p>The app should also be able to handle <strong>gibberish</strong>, a random word that will be marked as &quot;Out of scope&quot;. </p><p><img alt="../static/img/article/CleanShot_2020-10-27_at_00.24.16.gif" src="/covid19-safety-information/assets/images/CleanShot_2020-10-27_at_00.24.16-9fd23963e4f64505970a7d286592ed7e.gif"></p><p>You can always get some ideas and examples from already created <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a> App in <a href="https://wit.ai/apps/695984467678144/understanding" target="_blank" rel="noopener noreferrer">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="facebook-page"></a>Facebook Page<a class="hash-link" href="#facebook-page" title="Direct link to heading">#</a></h2><p>Messenger platform is built with Customer to Business communication in mind, so for Messenger bot to exist, it is a good idea to start by creating a Facebook Page for it. </p><p>The page can be used to guide potential users with the main features of the bot and share useful information with your audience in the future.</p><p>Start by opening the Facebook Page creation interface and filling the <strong>Name</strong> and <strong>Category</strong> fields. Best categories for your project could be &quot;Health&quot; or &quot;Education&quot;. You can skip adding profile and cover pictures and fill them later. When you are ready to proceed, hit <strong>Create Page</strong> and you are done.</p><p>Once the Page is created, it&#x27;ll be shown to you in Admin mode by default. You&#x27;ll need to switch to Visitor Preview mode to see how it&#x27;ll appear to visitors, and, most importantly, to access the Chat interface.</p><p><strong>&quot;Send Message&quot;</strong> action button will be shown and chat interface will be available to interact with users.</p><p><img alt="../static/img/article/2020-10-25_17.11.42.gif" src="/covid19-safety-information/assets/images/2020-10-25_17.11.42-73bbe35e547dee9c7e58ec6956afeabc.gif"></p><p>In its initial state chat is just the conversation, where human admins of the Page are interacting with visitors. What you want is a Machine that can do it automatically. Here enters the Facebook App — another step to automate process of having a dialog with your audience.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="facebook-app"></a>Facebook App<a class="hash-link" href="#facebook-app" title="Direct link to heading">#</a></h3><p>You will need to register as a developer on <a href="https://developers.facebook.com/" target="_blank" rel="noopener noreferrer">Facebook for Developers</a> portal. It&#x27;s easy! Just hit the &quot;<strong>Log in&quot;</strong> menu item at the top right corner of the page and accept the legal agreement to get started.</p><p>When you are done &quot;<strong>My Apps</strong>&quot; menu item will become available. Follow it and start creating an app.</p><p><img alt="../static/img/article/Screen_Shot_2020-10-25_at_2.41.00_PM.png" src="/covid19-safety-information/assets/images/Screen_Shot_2020-10-25_at_2.41.00_PM-c1a7e98dd7dd9472a067fbc72d03f651.png"></p><p>As this mentioned earlier, Messenger Platform initially was build to benefit and enrich business interactions, so App setup would go easier if you select <strong>&quot;Manage Business Integrations&quot;</strong> category on the first step. If you picked something else, or, literally &quot;Something Else&quot; — not a big deal! You can always customize features and integrations of the App in the future.</p><p>After the creation, you can add some products to the app. You are going to set up &quot;<strong>Messenger</strong>&quot;.</p><p>The first thing to do after clicking &quot;<strong>Set up</strong>&quot; button is to add a page. Follow the steps in the popup window and select your Facebook page that you want to use the bot with.</p><p><img alt="../static/img/article/2020-10-25_16.38.40.gif" src="/covid19-safety-information/assets/images/2020-10-25_16.38.40-355f6d9e5717d6feeb7f39217905b95c.gif"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="glitch-app"></a>Glitch App<a class="hash-link" href="#glitch-app" title="Direct link to heading">#</a></h2><p>Now, it&#x27;s time to add a code to hook up all these things together! You need a Node.js app to make a bridge between Facebook app and <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a> App. </p><p>No need to worry, there is a base code in the <a href="https://glitch.com/~covid-19-bot-tutorial" target="_blank" rel="noopener noreferrer">Glitch</a> and you can simply copy the whole project with &quot;<strong>Remix Projec</strong>t&quot; button and adjust it as you want. It is going to be a project with same code but act as a unique App with the unique combination of environment variables.</p><p><img alt="../static/img/article/Screen_Shot_2020-10-25_at_5.21.47_PM.png" src="/covid19-safety-information/assets/images/Screen_Shot_2020-10-25_at_5.21.47_PM-9870fccf6533e0622ee9daf634b9c28f.png"></p><p>It is a relatively simple Node.js app, which acts as a server to respond to requests, coming from the Facebook App. It handles two types of requests:</p><ul><li><code>GET /webhook</code> — to setup and verify a webhook URL</li><li><code>POST /webhook</code> — to receive, process and respond to incoming messages</li></ul><p>The app consists of four main modules:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="appjs---app-entry-point"></a>app.js - App entry point.<a class="hash-link" href="#appjs---app-entry-point" title="Direct link to heading">#</a></h3><p>This is where Express server and <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a> connection sets up and main two webhook request handlers are implemented.</p><p>The most notable part is the message handler code:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-jsx codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Retreiving unique sender id to identify user across different calls</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sender </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Define messages as array of objects</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// with required `text` parameter for the message</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// and a possible `meta` field with potential additional configuration</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to enhance the message with attachments or Quick Replies in the future</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Setting it with default message to provide usage guide for new users</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> messages </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;You can ask me for advice whether it is safe to perform an activity in COVID-19 pandemic times. For example: &quot;Is it safe to go to a restaurant?&quot;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Fetching the quiz session object, associated with the sender</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to understand whether you are in the process of quiz </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> currentQuiz </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> quiz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getRunningQuiz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentQuiz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// If you are — pass the inbound text to the handler function </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to continue or to end the ongoing quiz</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  messages </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> quiz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">handleQuizAnswer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentQuiz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Otherwize — pass the text to WIT.AI to recongize intent and activity from it</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> intents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> entities </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> wit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">intents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">length </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> topIntent </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> intents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      topIntent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;safety_info&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">isArray</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">entities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;activity:activity&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> activity </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> entities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;activity:activity&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// If recognized intent has the name &quot;safety_info&quot; and &quot;activity:activity&quot; entity </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// accociated with it - start a new quiz, with current user and activity</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      messages </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> quiz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">startQuiz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> activity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Deliver the message to the user</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> messenger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">sendMessages</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> messages</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="quizjs"></a>quiz.js<a class="hash-link" href="#quizjs" title="Direct link to heading">#</a></h3><p>This is the module, you are free to customize. It has the Quiz Q&amp;A data:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-jsx codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> quizSteps </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    columnName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Masks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;How likely you and people around you will wear a mask?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    quickReplies</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;🙂 Not likely&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;🤷‍♀️ Maybe&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;😷 Definitely&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    columnName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Crowds&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;How crowded the place will be?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    quickReplies</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;👨‍👩‍👦‍👦 Crowded&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;👫 Maybe&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;🧍‍♀️ Not at all&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    columnName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Air&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    question</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;How enclosed the space will be around you?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    quickReplies</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;🏡 Enclosed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;🏕 Maybe&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;🤸‍♀️ Not at all&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Where each step of it has a <code>question</code> and set of <code>quickReplies</code> to suggest to the User. Field <code>columnName</code> represents the name of the column in Airtable, used to store the answer, while User goes through the Quiz. Values, stored in the table are integers in range of 1-3.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="dbjs-and-messengerjs"></a>db.js and messenger.js<a class="hash-link" href="#dbjs-and-messengerjs" title="Direct link to heading">#</a></h3><p>These modules are used to help establish communication with Facebook Messenger Platform and Airtable API and to provide handy functions to perform basic operations — send messages, retrieve or update a record in Airtable database.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="environment-variables"></a>Environment Variables<a class="hash-link" href="#environment-variables" title="Direct link to heading">#</a></h2><p>Variables which get to set in the environment of the app, before it gets executed. Values then are used in code — this is a common practice to keep secret keys separate from the codebase.</p><p>In this project you can control them by modifying the <code>.env</code> file and Glitch has a neat UI to manage it:</p><p><img alt="../static/img/article/Untitled.png" src="/covid19-safety-information/assets/images/Untitled-fc769d9ef141e4320ba2891a9e077320.png"></p><p>Now, you are going to fill the environment variables which are required to connect Facebook app and <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a> app.</p><p>First, let&#x27;s get the app secret. Let&#x27;s go to your Facebook app → Settings → Basic. Copy and paste the <strong>App Secret</strong> in the FB_APP_SECRET of the Glitch <code>.env</code>. It may require your facebook password to get <strong>App Secret</strong> for the first time. </p><p><img alt="../static/img/article/2020-10-25_18.12.38.gif" src="/covid19-safety-information/assets/images/2020-10-25_18.12.38-347f5e3f8f00d31ad12ccaa7c0e59c1a.gif"></p><p>Then, let&#x27;s get the <strong>WIT_TOKEN</strong>. Go to your <a href="http://wit.AI" target="_blank" rel="noopener noreferrer">Wit.ai</a> app, copy <strong>Server Access</strong> token and paste it in the  <strong>WIT_TOKEN</strong> of the Glitch <code>.env</code></p><p><img alt="../static/img/article/2020-10-25_18.16.38.gif" src="/covid19-safety-information/assets/images/2020-10-25_18.16.38-1ecdbaa46d1275463e41cd6bf7928b76.gif"></p><p>You also need to provide other environment variables such as <strong>FB_PAGE_TOKEN</strong>, <strong>FB_VERIFY_TOKEN</strong>, <strong>AIRTABLE_API_KEY</strong>, <strong>AIRTABLE_DB_NAME</strong>. We can just type random values for these variables temporarily. </p><p>Go to your Facebook App → Messenger → Settings and generate click &quot;Add callback URL&quot;.  You can find callback URL in Glitch → Share → Live app. Paste it and don&#x27;t forget to add &quot;/webhook&quot; to the end of the url.</p><p><img alt="../static/img/article/2020-10-25_19.19.29.gif" src="/covid19-safety-information/assets/images/2020-10-25_19.19.29-b0782d6e9048b154d77022b756dce61f.gif"></p><p>The last step is <strong>FB_PAGE_TOKEN</strong>. Go to your Facebook app → Messenger → Settings and generate the token. Remove your previous <strong>FB_PAGE_TOKEN</strong> and paste the token.</p><p><img alt="../static/img/article/2020-10-25_19.24.35.gif" src="/covid19-safety-information/assets/images/2020-10-25_19.24.35-948936cf773a523bc84ae2a8944c1725.gif"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="airtable"></a>Airtable<a class="hash-link" href="#airtable" title="Direct link to heading">#</a></h2><p>Every time your Node app receives the message — you should assume it might be unaware of all previous actions. To keep it in context of ongoing conversation you have to keep the state of it in some <strong>persistence layer.</strong> </p><p>Some apps doesn&#x27;t require having one, but conversational apps, usually do. In this case, you will keep quiz progress across the dialog events and remove it, once the quiz is completed — you don&#x27;t need to keep any extra data after it.</p><p>You will use <a href="https://airtable.com/" target="_blank" rel="noopener noreferrer">Airtable</a> as a simple service to store session data for ongoing quizzes and access it with its handy JavaScript library.</p><p>Start by signing up for an Airtable account and creating a Workspace.</p><p><img alt="../static/img/article/CleanShot_2020-10-26_at_19.32.36.gif" src="/covid19-safety-information/assets/images/CleanShot_2020-10-26_at_19.32.36-ea06c5c68d7b9ade0a470a78544ee7fa.gif"></p><p>Next, create a Base. Choose <strong>&quot;Start from scratch&quot;</strong> and give it a name:</p><p><img alt="../static/img/article/CleanShot_2020-10-26_at_19.36.05.gif" src="/covid19-safety-information/assets/images/CleanShot_2020-10-26_at_19.36.05-535327335c0ec259b0a0d203cb6697a9.gif"></p><p>Your database will have a table, created for you by default:</p><p><img alt="../static/img/article/airtable1.png" src="/covid19-safety-information/assets/images/airtable1-6ffa9559c433e62c8778c397f0c62612.png"></p><p>You can keep it, but change it for your needs. Change the name of the table to <strong>&quot;Quizzes&quot;</strong> and configure four columns with the following configuration:</p><ul><li><strong>SessionId</strong> — Single line text</li><li><strong>Activity</strong> — Single line text</li><li><strong>Masks</strong> — Rating, Max 3 stars</li><li><strong>Crowds</strong> — Rating, Max 3 stars</li><li><strong>Air</strong> — Rating, Max 3 stars</li></ul><p>This is what end result should look like:</p><p><img alt="../static/img/article/airtable2.png" src="/covid19-safety-information/assets/images/airtable2-61d71c6ad8add15a0ceb357b3630f61d.png"></p><p>Now, to connect this table to your Glitch app, you&#x27;ll need to get its Base id and API Key. The easiest way to get them is to take a peek to its dynamically generated API documentation.</p><p>Navigate to: <a href="https://airtable.com/api" target="_blank" rel="noopener noreferrer">https://airtable.com/api</a> and select a Base to view its API documentation. </p><p>Scroll to <strong>&quot;Authentication&quot;</strong> section, switch to &quot;JavaScript&quot; and turn on &quot;show API key&quot; checkbox:</p><p><img alt="../static/img/article/airtable3.png" src="/covid19-safety-information/assets/images/airtable3-97486ddc5ae87d8177b6147c8b5a9e3b.png"></p><p>Let&#x27;s copy these values and paste them to your <code>.env</code> ****file in the Glitch app:</p><p><img alt="../static/img/article/airtable4.png" src="/covid19-safety-information/assets/images/airtable4-051d7fcb8e001dd71e7a0e79c1380e04.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="testing-your-chatbot"></a>Testing your Chatbot<a class="hash-link" href="#testing-your-chatbot" title="Direct link to heading">#</a></h2><p>Now that you have everything set up, navigate to your Facebook page, Click <strong>&quot;View as Visitor&quot;</strong> and, in visitor mode, click <strong>&quot;Send Message&quot;</strong>:</p><p><img alt="../static/img/article/CleanShot_2020-10-26_at_23.59.27.gif" src="/covid19-safety-information/assets/images/CleanShot_2020-10-26_at_23.59.27-822c448aa88640183b9879fa1024e973.gif"></p><p>Try to ask the bot whether it is safe to go to a restaurant and go through the quiz. It should rate your answers and give you an advice with a link to CDC page. </p><p>Yay! You did it! 🎉</p><p><img alt="../static/img/article/CleanShot_2020-10-27_at_00.07.14.gif" src="/covid19-safety-information/assets/images/CleanShot_2020-10-27_at_00.07.14-d00970770edae363430ab9917cff3285.gif"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="future-directions"></a>Future directions<a class="hash-link" href="#future-directions" title="Direct link to heading">#</a></h2><p>Now that you have an idea how Facebook Messenger Platform,  <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a>, Node.js App on Glitch and Airtable can work together to create conversational interfaces. Here are some ideas on what to do next:</p><ul><li>Try to modify <code>quizSteps</code> in <code>quiz.js</code> and try to go through the quiz with the new scenarios</li><li>Take a peek at <strong>&quot;Understanding&quot;</strong> section of your project&#x27;s  <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a> dashboard. New utterances, coming from production will appear at the top of the page — you can verify classification results and correct any mistakes to fine-tune your model</li><li>Train  <a href="http://wit.ai" target="_blank" rel="noopener noreferrer">Wit.ai</a> to recognize another intent, for instance &quot;Is loss of taste and smell is a symptom of COVID-19&quot; could stand for a <strong>&quot;symptoms_info&quot;</strong>. Add a code to handle it in message handler in <code>app.js</code></li><li>Here&#x27;s another idea! Add a table with Activities to Airtable database and fill it with activity names and associated CDC article links on this page: <a href="https://www.cdc.gov/coronavirus/2019-ncov/daily-life-coping/going-out.html" target="_blank" rel="noopener noreferrer">https://www.cdc.gov/coronavirus/2019-ncov/daily-life-coping/going-out.html</a>. Implement a lookup to provide a relevant link, if such Activity was found in the table.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="authors"></a>Authors<a class="hash-link" href="#authors" title="Direct link to heading">#</a></h2><ul><li><a href="https://github.com/janeshin059" target="_blank" rel="noopener noreferrer">Jane Hyeseo Shin</a></li><li><a href="https://michael.romanenko.kg/" target="_blank" rel="noopener noreferrer">Michael Romanenko</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/tutorial.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/covid19-safety-information/docs/mdx"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Powered by MDX</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#skills-and-conversation-scenarios" class="table-of-contents__link">Skills and Conversation Scenarios</a></li><li><a href="#dialog-example" class="table-of-contents__link">Dialog Example</a></li><li><a href="#training-witai" class="table-of-contents__link">Training Wit.ai</a></li><li><a href="#facebook-page" class="table-of-contents__link">Facebook Page</a><ul><li><a href="#facebook-app" class="table-of-contents__link">Facebook App</a></li></ul></li><li><a href="#glitch-app" class="table-of-contents__link">Glitch App</a><ul><li><a href="#appjs---app-entry-point" class="table-of-contents__link">app.js - App entry point.</a></li><li><a href="#quizjs" class="table-of-contents__link">quiz.js</a></li><li><a href="#dbjs-and-messengerjs" class="table-of-contents__link">db.js and messenger.js</a></li></ul></li><li><a href="#environment-variables" class="table-of-contents__link">Environment Variables</a></li><li><a href="#airtable" class="table-of-contents__link">Airtable</a></li><li><a href="#testing-your-chatbot" class="table-of-contents__link">Testing your Chatbot</a></li><li><a href="#future-directions" class="table-of-contents__link">Future directions</a></li><li><a href="#authors" class="table-of-contents__link">Authors</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/covid19-safety-information/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/covid19-safety-information/docs/doc2/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/covid19-safety-information/docs/privacy-policy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/covid19-safety-information/docs/terms-of-service">Terms of Service</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/romanenko/covid19-safety-information" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Jane Hyeseo Shin, Michael Romanenko. Built with Docusaurus.</div></div></div></footer></div>
<script src="/covid19-safety-information/styles.a26654e4.js"></script>
<script src="/covid19-safety-information/runtime~main.0f70fe0a.js"></script>
<script src="/covid19-safety-information/main.8d183635.js"></script>
<script src="/covid19-safety-information/1.8fe4b8f7.js"></script>
<script src="/covid19-safety-information/14.a472f813.js"></script>
<script src="/covid19-safety-information/15.9249cfa6.js"></script>
<script src="/covid19-safety-information/935f2afb.c60e4987.js"></script>
<script src="/covid19-safety-information/13.2fafe2e3.js"></script>
<script src="/covid19-safety-information/60875e34.75ca0863.js"></script>
</body>
</html>